declare var qg: any;

export class RESManager {

    fs: any;
    constructor() {
        this.fs = qg.getFileSystemManager();
    }

    downloadZip(url, name, callback) {

        let tempFilePath = qg.env.USER_DATA_PATH + "/" + name;
        let task = qg.downloadFile({
            url: url,
            filePath: tempFilePath,
            success: (msg) => {
                console.log('下载成功');
                console.log(tempFilePath)

                this.fs.getFileInfo({
                    filePath: tempFilePath,
                    success: (res) => {
                        console.log('getFileInfo:', JSON.stringify(res))
                    },
                    fail: function () {
                        console.log('getFileInfo fial')
                    }
                })
                this.fs.unzip({
                    zipFilePath: tempFilePath,
                    targetPath: qg.env.USER_DATA_PATH,
                    success() {
                        console.log('解压成功')
                        callback();
                    },
                    fail() {
                        console.log('解压失败')
                    }
                })


            },
            fail(msg) {
                console.log('下载失败 ', JSON.stringify(msg))
                // 下载失败
            },
            complete() {
                console.log('complete');
            }
        });

        task.onProgressUpdate(function (res) {
            console.log('下载zip', res.progress);
        });

    }
}